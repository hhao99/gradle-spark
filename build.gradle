import de.undercouch.gradle.tasks.download.Download

plugins {
    id "de.undercouch.download" version "1.2"
}

apply plugin: 'scala'
apply plugin: 'eclipse'
apply plugin: 'idea'

apply from: 'gradle/tools.gradle'

sourceCompatibility = 1.8
version = '1.0'
description = "Apache Spark + Hadoop meetup group. Intro workshop Apr 20"

repositories {
    jcenter()
}

def scalaVersion = '2.10.4'
def sparkVersion = '1.3.1'
def hadoopVersion = '2.6'

repositories {
    flatDir {
        dirs "$projectDir/build/spark-$sparkVersion-bin-hadoop$hadoopVersion/lib"
    }
}

dependencies {
    // this will download scala for you
    compile "org.scala-lang:scala-library:$scalaVersion"
//    compile "org.scala-lang:jline:$scalaVersion"

    // this is the standalone jar for most spark projects
    compile files("$projectDir/build/spark-$sparkVersion-bin-hadoop$hadoopVersion/lib/spark-assembly-$sparkVersion-hadoop$hadoopVersion.0.jar") {
        builtBy 'extractSparkDistro'
    }

    // this is spark core - with all the transiative deps
//    compile "org.apache.spark:spark-core_$scalaMajorVersion:$sparkVersion"
    // optional: hadoop cluster
//    compile "org.apache.hadoop:hadoop-client:$hadoopVersion.0"

    testCompile group: 'junit', name: 'junit', version: '4.11'
}

import de.undercouch.gradle.tasks.download.Download

task downloadExampleData(type: Download) {
    group "Lab"
    description "Download the data examples"
    src "https://copy.com/0JLiJiXzNZOa1TvL/Spark/data.tar.gz?download=1"
    dest dataDestDir
    overwrite false
}

task extractExampleData(type: Copy, dependsOn: downloadExampleData) {
    group "Lab"
    description "ExtractExampleData"
    from tarTree(dataDestDir)
    into file(dataDestDir).parentFile
}

task sparkTestShell {
    group "TODO: Use Spark"
    description "Open the Scala Console with the test classpath"
    dependsOn scalaTestConsole
}
